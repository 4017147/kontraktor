<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
</head>
<body style="padding-top: 10px;">

<script type='text/javascript' src='js/knockout3.2.0.js'></script>
<script type='text/javascript' src='js/jquery-2.1.1.js'></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

<!--<img src="img/CDC-160_control_panel.jpg">-->

<!--<div style="padding-top: 150px; padding-left: 60px; padding-right: 60px; background-image: url('img/full_control_120.png'); background-repeat: no-repeat;">-->
<div style="padding-top: 20px; padding-left: 60px; padding-right: 60px;">

    <div role="form">

        <div class="row">
            <!--<div class="fOOorm-group col-sm-4">-->
                <span><img src="img/full_control_120.png">
                <label style='font-size: large;'>&nbsp;&nbsp;<b>Published Scheduler:&nbsp;</b> </label>
                <select style='font-size: larger;' data-bind="options: publishedSchedulers, value: published, attr: { style: error }"></select></span>
                <!--<input class='form-control' data-bind="value: published, attr: { style: error }" />-->
                <b style="color: #a22;" data-bind="text: errorMsg"></b>
            <!--</div>-->
        </div>

    </div>

    <br>


    <table class="table table-bordered table-condensed">
        <tbody>
        <tr>
            <td width="50%">Scheduled Dispatcher Threads</td>
            <td data-bind="text: $data.scheduler().numDispatchers"></td>
        </tr>
        <tr>
            <td>Isolated Dispatcher Threads:</td>
            <td><span data-bind="text: $data.scheduler().isolatedThreads"></span></td>
        </tr>
        <tr>
            <td>Default Q Size:</td>
            <td><span data-bind="text: $data.scheduler().defQSize"></span></td>
        </tr>
        </tbody>
    </table>

    <table class="table table-bordered table-compact">
        <thead>
        <tr>
            <th align="LEFT">&nbsp;</th>
            <th align="LEFT">Name</th>
            <th align="LEFT">#Actors</th>
            <th align="LEFT">fullest queue</th>
            <th align="LEFT">sum queued msg</th>
        </tr>
        </thead>
        <tbody data-bind="foreach: dispatchers">
        <tr>
            <td>&nbsp;</td>
            <td data-bind="text: $data[0].name"></td>
            <td data-bind="text: $data[0].numActors"></td>
            <td><span data-bind="text: $data[0].loadPerc"></span>%</td>
            <td data-bind="text: $data[0].qSizes"></td>
        </tr>
        </tbody>
    </table>

</div>
<script>

    var Model = function (published, port) {
        this.published = ko.observable(published);
        this.scheduler = ko.observable({numDispatchers: "-"});
        this.dispatchers = ko.observableArray([]);
        this.publishedSchedulers = ko.observableArray([]);
        this.error = ko.observable("");
        this.errorMsg = ko.observable("");
    };

    var model = new Model("scheduler_", 7777);
    ko.applyBindings(model);

    var refreshTimer = function () {
        refresh();
        window.setTimeout(refreshTimer, 1000);
    };

    $.getJSON("monitor/getMonitorableKeys/ElasticScheduler", function(list) {
        console.log(list.args[0]);
        model.publishedSchedulers(list.args[0]);
        refreshTimer();
    });
    var refresh = function () {
        var url = "monitor/report/" + model.published() + "/1";
        $.getJSON(url, function (data) {
            console.log(data);
            if ( data.args[0] == null ) {
                model.error("background-color: #fc0;");
                model.errorMsg(data.args[1]);
            } else {
                var schedulerReport = data.args[0][0];
                var dispatcherArray = data.args[0][1];
                console.log(dispatcherArray);
                model.scheduler(schedulerReport);
                model.dispatchers(dispatcherArray);
                model.error("");
                model.errorMsg("");
            }
        }).error(function() {
            model.error("background-color: #fc0;");
        });
    };

</script>


</body>
</html>